{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/idplay/src/components/MapPicker.tsx"],"sourcesContent":["import React, { useEffect, useState, useCallback } from \"react\";\r\nimport {\r\n  MapContainer,\r\n  TileLayer,\r\n  Marker,\r\n  Popup,\r\n  useMapEvents,\r\n  useMap,\r\n} from \"react-leaflet\";\r\nimport type { LatLng, Icon } from \"leaflet\";\r\nimport L from \"leaflet\";\r\nimport type { Position, Odp } from \"../types\";\r\n\r\ninterface MapPickerProps {\r\n  selectedPosition: Position | null;\r\n  onLocationSelect: (latlng: LatLng) => void;\r\n}\r\n\r\n// User's selected location marker icon\r\nconst userIcon: Icon = L.icon({\r\n  iconUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png\",\r\n  shadowUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png\",\r\n  iconSize: [25, 41],\r\n  iconAnchor: [12, 41],\r\n  popupAnchor: [1, -34],\r\n  shadowSize: [41, 41],\r\n});\r\n\r\n// ODP location marker icon\r\nconst odpIcon: Icon = L.icon({\r\n  iconUrl:\r\n    \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDYzRkYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNNSAxMi41NWEzIDExIDAgMCAxIDE0LjA4IDAiPjwvcGF0aD48cGF0aCBkPSJNMS40MiA5YTE2IDE2IDAgMCAxIDIxLjE2IDAiPjwvcGF0aD48cGF0aCBkPSJNOC41MyAxNi4xMWE2IDYgMCAwIDEgNi45NSAwIj48L3BhdGg+PGxpbmUgeDE9IjEyIiB5MT0iMjAiIHgyPSIxMi4wMSIgeTI9IjIwIj48L2xpbmU+PC9zdmc+\",\r\n  iconSize: [32, 32],\r\n  iconAnchor: [16, 32],\r\n  popupAnchor: [0, -32],\r\n});\r\n\r\n// Helper component to handle map clicks\r\nconst MapClickHandler: React.FC<{\r\n  onLocationSelect: (latlng: LatLng) => void;\r\n}> = ({ onLocationSelect }) => {\r\n  useMapEvents({\r\n    click(e) {\r\n      onLocationSelect(e.latlng);\r\n    },\r\n  });\r\n  return null;\r\n};\r\n\r\n// Helper component to update map view when position changes\r\nconst MapViewUpdater: React.FC<{ position: Position | null }> = ({\r\n  position,\r\n}) => {\r\n  const map = useMap();\r\n  useEffect(() => {\r\n    if (position) {\r\n      map.flyTo([position.lat, position.lng], 16); // Zoom in closer\r\n    }\r\n  }, [position, map]);\r\n\r\n  return null;\r\n};\r\n\r\n// Helper component to handle map events for performance and stability\r\nconst MapEventsHandler: React.FC<{\r\n  allOdps: Odp[];\r\n  setVisibleOdps: React.Dispatch<React.SetStateAction<Odp[]>>;\r\n}> = ({ allOdps, setVisibleOdps }) => {\r\n  const map = useMap();\r\n\r\n  const updateVisibleMarkers = useCallback(() => {\r\n    if (!map || allOdps.length === 0) return;\r\n    const bounds = map.getBounds();\r\n    const visible = allOdps.filter((odp) => {\r\n      const latLng = L.latLng(odp.center.lat, odp.center.lng);\r\n      return bounds.contains(latLng);\r\n    });\r\n    setVisibleOdps(visible);\r\n  }, [map, allOdps, setVisibleOdps]);\r\n\r\n  useEffect(() => {\r\n    // Invalidate map size on initial load and resize to fix rendering issues\r\n    const handleResize = () => map.invalidateSize();\r\n\r\n    // Use a short timeout to ensure the map container has its final dimensions\r\n    const timer = setTimeout(() => {\r\n      map.invalidateSize();\r\n      updateVisibleMarkers();\r\n    }, 150);\r\n\r\n    window.addEventListener(\"resize\", handleResize);\r\n\r\n    return () => {\r\n      clearTimeout(timer);\r\n      window.removeEventListener(\"resize\", handleResize);\r\n    };\r\n  }, [map, updateVisibleMarkers]);\r\n\r\n  useMapEvents({\r\n    moveend: updateVisibleMarkers,\r\n    zoomend: updateVisibleMarkers,\r\n  });\r\n\r\n  return null;\r\n};\r\n\r\nconst MapPicker: React.FC<MapPickerProps> = ({\r\n  selectedPosition,\r\n  onLocationSelect,\r\n}) => {\r\n  const [allOdpLocations, setAllOdpLocations] = useState<Odp[]>([]);\r\n  const [visibleOdps, setVisibleOdps] = useState<Odp[]>([]);\r\n\r\n  // Center near ODP locations\r\n  const initialCenter: Position = { lat: -6.464, lng: 107.906 };\r\n  const initialZoom = 15;\r\n\r\n  useEffect(() => {\r\n    const fetchOdpData = async () => {\r\n      try {\r\n        const response = await fetch(\"/odp-locations.json\");\r\n        if (!response.ok) {\r\n          throw new Error(\"Network response was not ok\");\r\n        }\r\n        const data: Odp[] = await response.json();\r\n        setAllOdpLocations(data);\r\n      } catch (error) {\r\n        console.error(\"Failed to fetch ODP locations:\", error);\r\n      }\r\n    };\r\n    fetchOdpData();\r\n  }, []);\r\n\r\n  return (\r\n    <MapContainer\r\n      center={initialCenter}\r\n      zoom={initialZoom}\r\n      scrollWheelZoom={true}\r\n      className=\"h-full w-full\"\r\n    >\r\n      <TileLayer\r\n        attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n      />\r\n      <MapClickHandler onLocationSelect={onLocationSelect} />\r\n      <MapViewUpdater position={selectedPosition} />\r\n      <MapEventsHandler\r\n        allOdps={allOdpLocations}\r\n        setVisibleOdps={setVisibleOdps}\r\n      />\r\n\r\n      {/* User's selected marker */}\r\n      {selectedPosition && (\r\n        <Marker position={selectedPosition} icon={userIcon}>\r\n          <Popup>\r\n            Lokasi Pilihan Anda <br /> Lat: {selectedPosition.lat.toFixed(6)},\r\n            Lng: {selectedPosition.lng.toFixed(6)}\r\n          </Popup>\r\n        </Marker>\r\n      )}\r\n\r\n      {/* Render only visible ODP markers */}\r\n      {visibleOdps.map((odp, index) => (\r\n        <Marker key={index} position={odp.center} icon={odpIcon}>\r\n          <Popup>\r\n            <b>ODP:</b> {odp.ODP}\r\n          </Popup>\r\n        </Marker>\r\n      ))}\r\n    </MapContainer>\r\n  );\r\n};\r\n\r\nexport default MapPicker;\r\n"],"names":[],"mappings":"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","debugId":null}}]
}